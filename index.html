<!DOCTYPE html>
<html>
  <head>
    <title>Happy Birthday to James</title>
    <script src="https://unpkg.com/parse/dist/parse.min.js"></script>
    <script>
      Parse.initialize('be4a2836d3d1cbad5cc0911fa2147d02e25b277c', 'adf9343dfkfd');
      Parse.serverURL = 'https://www.jabuwings.com/api';
      
    </script>
  </head>
<body>
<h6>Happy Birthday to James</h1>
<p id="info">Please wait</p>
  <div id="form" style="display:none">
  <input id="phone"/>
    <label for="phone">Enter your phone number</label>
    
    <button onclick="get()">Get your free credit</button>
  </div>
  <p id="oops"></p>
         <p id="success" style="display:none">Oya..... You are the lucky one. Congratulations</p>
  
  <script>
    new Parse.Query('App').equalTo('name', 'birthday_promo').first().then(function(object){
      if(object && object.get('active')){
        console.log('promo active')
        document.getElementById('info').style.display='none';
        document.getElementById('form').style.display='block';
        
      } else{
         document.getElementById('oops').innerText='Oops. Unfortunately, the promo has ended and was won by '+object.get('value');
         }
      
    })
         
         function get(){
          var phone = document.getElementById('phone').value;
          Parse.Cloud.run('jamesbirthdaypromo',{phone: phone}).then(function(response){
            document.getElementById('success').style.display = 'block';             
          }).catch(function(e){
                  document.getElementById('oops').innerText=e.message;
           })
         
         }

  </script>
</body>
</html>
